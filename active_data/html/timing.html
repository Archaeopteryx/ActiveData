<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this
   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->
<HTML>
<HEAD>
	<script type="text/javascript" src="modevlib/imports/import.js"></script>
</HEAD>
<BODY style="position:relative;">

<div style="position:absolute;left:10px;right:10px;">
	<h3 id="title">Past week of Test Failures<span id="status" style="height:30px">Page Loading...</span><span class="loading"><img src="images/spinner.gif" alt=""></span></h3>

	<div id="chart" class="chart" style="text-align:center;width:800px;height:300px;"></div>
	<div id="details" style="overflow-y: scroll;height:300px;position:absolute;right:10px;left:10px;"></div>
</div>


<script type="application/javascript">


importScript(['js/util.js', 'js/failures.js'], function(){

	var DEBUG = true;  // TAKES A SMALLER SAMPLE FOR FASTER ITERATION

	var __main = function*(){
		var all_steps = null;

		var a = Log.action("find test failures", true);
		try {
			//PULL FAILURE DETAILS
			var result = yield (search({
				"select":[
					{"value":"order","aggregate":"average"},
					{"aggregate":"count"}
				],
				"edges":[{
					"name":"step",
					"value":{"coalesce":["builder.step","harness.step"]}
				}],
				"from":"jobs.action.timings",
				"where":{"eq":{"build.platform":"win32"}},
				"limit":1000,
				"format":"list"
			}));
			all_steps = result.data;
		} catch (e) {
			Log.error("Find steps", e);
		} finally {
			Log.actionDone(a);
		}//try







		} finally {
			Log.actionDone(a);
		}//try

		yield (null);
	};


	Thread.showWorking = function(numThread){
		var l = $(".loading");
		l.show();
	};//function

	Thread.hideWorking = function(){
		var l = $(".loading");
		l.hide();
	};//function


	var thread;
	var main = function(){
		if (thread !== undefined)
			thread.kill();
		thread = Thread.run(__main());
//		thread = Thread.run(__testChart());
	};

	$(document).ready(function(){
		main();
	});

});

</script>


</BODY>
</HTML>

